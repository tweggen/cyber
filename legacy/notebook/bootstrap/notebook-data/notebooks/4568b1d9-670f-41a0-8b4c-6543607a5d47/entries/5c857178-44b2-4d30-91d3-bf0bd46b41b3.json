{
  "id": "5c857178-44b2-4d30-91d3-bf0bd46b41b3",
  "content": "DECISION 2-3: Orphan Threshold Calibration Implementation\n\nAUTHOR: agent-calibration\n\nDESIGN DECISIONS:\n\n1. MODULE STRUCTURE:\n   - Create crates/notebook-entropy/src/calibration.rs for all threshold calibration logic\n   - Export from lib.rs: ThresholdCalibrator, NotebookConfig\n   - Keep implementation focused on statistical tracking and threshold computation\n\n2. ThresholdCalibrator IMPLEMENTATION:\n   - Track running statistics incrementally (count, sum, sum_of_squares)\n   - No storage of individual values - O(1) memory regardless of observations\n   - Default threshold = mean + 2*stddev (captures ~95% of normal observations)\n   - Minimum observations required before computing (configurable, default 10)\n   - Fallback threshold when insufficient data (configurable, default 0.7)\n\n3. NotebookConfig STRUCTURE:\n   - orphan_threshold: Option<f64> - manual override, takes precedence\n   - auto_calibrate: bool - enable adaptive threshold computation\n   - default: auto_calibrate = true, orphan_threshold = None\n   - Config stored separately from calibrator state\n\n4. is_orphan() LOGIC:\n   - If orphan_threshold is Some(t), use fixed threshold\n   - Else if auto_calibrate, use compute_threshold()\n   - Compare cost.catalog_shift against threshold\n   - Also check if entry has no references (semantic orphan check)\n\n5. API METHODS:\n   - ThresholdCalibrator::new() -> Self\n   - observe(&mut self, catalog_shift: f64) - add observation\n   - compute_threshold(&self) -> f64 - returns mean + 2*stddev\n   - is_orphan(&self, cost: &IntegrationCost) -> bool\n   - observation_count(&self) -> usize\n   - mean(&self) -> f64, stddev(&self) -> f64 - for inspection\n   - reset(&mut self) - clear accumulated statistics\n\n6. INTEGRATION NOTES:\n   - Task 2-5 will use calibrator alongside engine\n   - Calibrator receives catalog_shift from each compute_cost() result\n   - Per-notebook calibrators for notebook-specific thresholds\n   - Thread-safe for read operations (compute_threshold, is_orphan)\n\n7. TEST COVERAGE PLAN:\n   - new(): creates empty calibrator\n   - observe(): increments count, updates running stats\n   - compute_threshold(): returns fallback when insufficient data\n   - compute_threshold(): returns mean + 2*stddev with sufficient data\n   - is_orphan(): respects manual override\n   - is_orphan(): uses computed threshold when auto_calibrate\n   - is_orphan(): considers references for orphan detection\n   - reset(): clears all accumulated statistics\n   - Edge cases: zero observations, single observation, identical values\n\nREFERENCES: Task 2-2 engine API for IntegrationCost structure.",
  "content_type": "text/plain",
  "topic": "decision 2-3",
  "references": [
    "cb2daf32-61c4-42a2-963d-23c301402c8c",
    "7e8e6170-3b6b-43ef-b5e0-e9ee0b1388d4"
  ],
  "revision_of": null,
  "author": "agent-calibration",
  "causal_position": {
    "sequence": 56,
    "activity_context": {
      "entries_since_last_by_author": 0,
      "total_notebook_entries": 55,
      "recent_entropy": 25.0
    }
  },
  "created": "2026-02-05T11:11:28.582544+00:00",
  "integration_cost": {
    "entries_revised": 0,
    "references_broken": 0,
    "catalog_shift": 0.0,
    "orphan": false
  }
}