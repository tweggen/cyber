{
  "id": "29992c32-c70b-43db-80c2-fd46e8c301e3",
  "content": "DECISION: Task 4-3 Event Streaming (SSE) Implementation\n\nCOMPONENTS:\n1. events.rs - Broadcast channel management for pub/sub\n2. routes/events.rs - SSE endpoint handler\n3. routes/mod.rs - Register events routes\n\nARCHITECTURE:\n- Use tokio::sync::broadcast for multi-subscriber pub/sub\n- Add axum-extra with sse feature for SSE support\n- EventBroadcaster struct manages per-notebook channels\n- Events published on WRITE/REVISE via integration with entries.rs\n\nEVENT FORMAT:\n```\nevent: entry\ndata: {\"entry_id\": \"...\", \"operation\": \"write\"|\"revise\", \"integration_cost\": {...}}\n\nevent: heartbeat\ndata: {\"timestamp\": \"...\"}\n```\n\nBROADCAST CHANNEL:\n- Channel capacity: 256 events (configurable)\n- Lagged receivers get catch-up marker with current sequence\n- Heartbeat every 30s to keep connections alive\n\nSSE ENDPOINT:\n- GET /notebooks/{notebook_id}/events\n- Content-Type: text/event-stream\n- Validates notebook exists before streaming\n- Graceful cleanup on client disconnect\n\nBACKPRESSURE HANDLING:\n- Use broadcast::Receiver::recv() which returns RecvError::Lagged on overflow\n- Send catch-up marker when lagged, client should OBSERVE to sync\n\nINTEGRATION:\n- Events module added to AppState\n- entries.rs publishes events after successful WRITE/REVISE\n- Minimal coupling - events module is optional enhancement\n\nDEPENDENCIES TO ADD:\n- axum-extra = { version = \"0.10\", features = [\"sse\"] } (workspace)\n- futures = \"0.3\" (for Stream trait in notebook-server)",
  "content_type": "text/plain",
  "topic": "decision 4-3",
  "references": [
    "5902f9b5-a023-4e7c-9bf4-96e58467aa31"
  ],
  "revision_of": null,
  "author": "anonymous",
  "causal_position": {
    "sequence": 85,
    "activity_context": {
      "entries_since_last_by_author": 12,
      "total_notebook_entries": 84,
      "recent_entropy": 52.4
    }
  },
  "created": "2026-02-05T15:09:50.433886+00:00",
  "integration_cost": {
    "entries_revised": 0,
    "references_broken": 0,
    "catalog_shift": 0.0,
    "orphan": false
  }
}