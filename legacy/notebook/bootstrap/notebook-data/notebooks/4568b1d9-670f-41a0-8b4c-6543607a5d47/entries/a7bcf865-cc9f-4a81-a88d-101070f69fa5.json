{
  "id": "a7bcf865-cc9f-4a81-a88d-101070f69fa5",
  "content": "DECISION 3-1: Catalog Generation Design\n\nAUTHOR: agent-catalog\n\nDATA STRUCTURES:\n\n1. Catalog - Main output structure:\n   - clusters: Vec<ClusterSummary> (ordered by significance)\n   - notebook_entropy: f64 (overall entropy measure)\n   - total_entries: u32 (count of entries in snapshot)\n   - generated_at: CausalPosition (timestamp of generation)\n\n2. ClusterSummary - Per-cluster summary:\n   - topic: String (extracted from cluster.topic_keywords, joined)\n   - summary: String (extractive summary from first entry content)\n   - entry_count: u32 (cluster.entry_ids.len())\n   - cumulative_cost: f64 (sum of catalog_shift for cluster entries)\n   - stability: u64 (entries since last cluster modification)\n   - representative_entry_ids: Vec<EntryId> (first N entries)\n\nALGORITHM:\n\n1. CatalogGenerator::generate(snapshot: &CoherenceSnapshot, entries: &[Entry], max_tokens: usize) -> Catalog\n2. Map each cluster to ClusterSummary:\n   - topic = join top 3 keywords with \", \"\n   - summary = extract first ~100 chars from first text entry\n   - cumulative_cost = sum of integration_cost.catalog_shift for all entries\n   - stability = current_sequence - max(entry_sequences in cluster)\n   - representative_entry_ids = first 3 entry_ids\n3. Sort by cumulative_cost DESC, then stability DESC\n4. Truncate to fit token budget (estimate 75 tokens per summary)\n5. Compute notebook_entropy as sum of all cluster cumulative_costs\n\nTOKEN ESTIMATION:\n- Each ClusterSummary ~75 tokens average\n- Default max_tokens: 4000\n- Max clusters = max_tokens / 75 = ~53\n- Truncate clusters list if exceeds budget\n\nINTEGRATION:\n- Takes CoherenceSnapshot from engine (Phase 2 output)\n- Needs access to Entry list for content extraction\n- Returns Catalog suitable for BROWSE endpoint\n\nNO DEPENDENCIES ON:\n- coherence.rs (read-only access to CoherenceSnapshot)\n- engine.rs (read-only access)\n- notebook-server/* (not touching)\n\nFILE OWNERSHIP:\n- CREATE: crates/notebook-entropy/src/catalog.rs\n- MODIFY: crates/notebook-entropy/src/lib.rs (add module export)",
  "content_type": "text/plain",
  "topic": "decision 3-1",
  "references": [
    "8697d124-2bfe-4251-ad70-8b3be2cc9008",
    "421ae951-9f47-4344-abe6-03838ede51ef"
  ],
  "revision_of": null,
  "author": "anonymous",
  "causal_position": {
    "sequence": 75,
    "activity_context": {
      "entries_since_last_by_author": 4,
      "total_notebook_entries": 74,
      "recent_entropy": 38.3
    }
  },
  "created": "2026-02-05T14:40:19.642208+00:00",
  "integration_cost": {
    "entries_revised": 0,
    "references_broken": 0,
    "catalog_shift": 0.0,
    "orphan": false
  }
}