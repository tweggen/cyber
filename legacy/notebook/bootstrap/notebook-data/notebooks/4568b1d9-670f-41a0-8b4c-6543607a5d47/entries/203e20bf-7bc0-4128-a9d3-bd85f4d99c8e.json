{
  "id": "203e20bf-7bc0-4128-a9d3-bd85f4d99c8e",
  "content": "TASK: Implement causal position assignment system for entries.\n\nCONTEXT: Each entry gets a CausalPosition that establishes its place in the causal chain. This includes a monotonic sequence number and an ActivityContext capturing the notebooks state at write time.\n\nIMPLEMENTATION:\n\nCausalPositionService:\n- assign_position(notebook_id, author_id) -> CausalPosition\n  - Atomically increments notebook sequence counter\n  - Computes ActivityContext:\n    - entries_since_last_by_author: count of entries in notebook since this authors last write\n    - total_notebook_entries: current total entries in notebook\n    - recent_entropy: rolling sum of integration_cost.catalog_shift over last N entries (N=10)\n\nStorage Requirements:\n- Per-notebook sequence counter (in notebooks table or separate)\n- Efficient query for authors last entry in notebook\n- Efficient rolling window for recent entropy\n\nAtomicity:\n- Position assignment MUST be atomic with entry storage\n- Use database transaction, not application-level locking\n- Sequence must never have gaps or duplicates within a notebook\n\nACCEPTANCE:\n- CausalPosition assigned correctly on every write\n- Sequence numbers are strictly monotonic per notebook\n- ActivityContext values are accurate\n- Concurrent writes handled correctly (no race conditions)\n- Unit tests for position assignment\n\nDEPENDENCY: Builds on Task 1.1 storage layer.\n\nREFERENCES: See types module for CausalPosition, ActivityContext structures.",
  "content_type": "text/plain",
  "topic": "task-assignment 1-2",
  "references": [
    "46ee8ade-fba4-4238-a0fd-27a1a838d8fa",
    "993307ab-9def-4788-a383-5eafa450509c"
  ],
  "revision_of": null,
  "author": "orchestrator",
  "causal_position": {
    "sequence": 27,
    "activity_context": {
      "entries_since_last_by_author": 11,
      "total_notebook_entries": 26,
      "recent_entropy": 11.8
    }
  },
  "created": "2026-02-05T10:43:01.505127+00:00",
  "integration_cost": {
    "entries_revised": 0,
    "references_broken": 0,
    "catalog_shift": 0.5,
    "orphan": false
  }
}